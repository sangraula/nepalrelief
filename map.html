<!DOCTYPE html>
<html>
    
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <meta charset="utf-8">
        <title>Nepal Relief</title>
        <style>
            html, body, #map-canvas {
                margin: 0px;
                padding: 0px;
            }
            #map-canvas {
                margin-top:20px;
                height:800px;
                width:1000px;
                float:left
            }
            #div_volunteers div {
                padding: 2px;
                margin: 2px;
                font-size:12px;
                background-color:#eeeeee;
            }
            #div_bad_volunteers div {
                padding: 2px;
                margin: 2px;
                font-size:12px;
                background-color:#bbbbbb;
            }
            #div_volunteers, #div_bad_volunteers {
                overflow: scroll;
                height:400px;
                width:400px;
                float:left;
                margin-top: 20px;
            }
            #div_heading {
                height: 800px;
                width: 400px;
                float:left;
            }
        </style>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
        <!-- add parse js -->
        <script src="https://www.parsecdn.com/js/parse-latest.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.js"></script>
        <script>
            // This example creates circles on the map, representing
            // populations in North America.

            // First, create an object containing LatLng and population for each city.
            var citymap = {};
            citymap['chicago'] = {
                center: new google.maps.LatLng(28.004, 84.753),
                population: 200
            };
            citymap['newyork'] = {
                center: new google.maps.LatLng(27.639, 85.055),
                population: 800
            };
            citymap['losangeles'] = {
                center: new google.maps.LatLng(27.460, 85.619),
                population: 400
            };
            citymap['vancouver'] = {
                center: new google.maps.LatLng(27.532, 85.749),
                population: 600
            };

            var cityCircle;

            function initialize() {
                // Create the map.
                var mapOptions = {
                    zoom: 8,
                    center: new google.maps.LatLng(27.532, 85.749) //,
                    //    mapTypeId: google.maps.MapTypeId.TERRAIN
                };

                var map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);

                // Construct the circle for each value in citymap.
                // Note: We scale the area of the circle based on the population.
                for (var city in citymap) {
                    var populationOptions = {
                        strokeColor: '#FF0000',
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: '#FF0000',
                        fillOpacity: 0.35,
                        map: map,
                        center: citymap[city].center,
                        radius: Math.sqrt(citymap[city].population) * 100
                    };
                    // Add the circle for this city to the map.
                    cityCircle = new google.maps.Circle(populationOptions);
                }
            }

            google.maps.event.addDomListener(window, 'load', initialize);

            $(document).ready(function() {
                Parse.initialize("0UHsh8uG4qsFbCsOqEzrbh0zxkTMld3Z4LKa9hge", "VRZRFXlJ5wmWd7XuZmkkwQawxkHJ91Tw6gxChtaT");

                var volunteerObj = Parse.Object.extend("Volunteer", {
                    checkIfUsableInMap: function() {
                        if ((this.get("lat") == undefined) && (this.get("long") == undefined)) {
                            return false;
                        } else {
                            return true;
                        };
                    },

                });
                var volunteerList = Parse.Collection.extend({
                    model: volunteerObj,
                    query: (new Parse.Query(volunteerObj)),

                    comparator: function(volunteerObj) {
                        return volunteerObj.get('updatedAt');
                    }
                });

                var volunteerLists = new volunteerList;

                volunteerLists.query.descending("updatedAt");
                volunteerLists.fetch({
                    success: function(collection) {
                        collection.each(function(volunteer) {
                            var divTitle = volunteer.attributes.name + "-" + volunteer.get("updatedat") + ":" + volunteer.attributes.phone + "," + volunteer.attributes.needType + "," + volunteer.attributes.item;
                            if (volunteer.checkIfUsableInMap() === false) {

                                $("#div_bad_volunteers").append("<div title='" + divTitle + "' ><div>Name: " + volunteer.attributes.name + " from " + volunteer.attributes.place + ",</div>" + "<div>Lat :" + volunteer.attributes.lat + ", long:" + volunteer.attributes.long + " </div>" + "</div>");

                            } else {
                                $("#div_volunteers").append("<div title='" + divTitle + "' ><div>Name: " + volunteer.attributes.name + " from " + volunteer.attributes.place + ",</div>" + "<div>Lat :" + volunteer.attributes.lat + ", long:" + volunteer.attributes.long + " </div>" + "</div>");

                            };
                        });
                    },
                    error: function(collection, error) {
                        // The collection could not be retrieved.
                    }
                });


            });
        </script>
    </head>
    
    <body>
        <div id="div_container">
            <div id="div_heading">
                <div>Register as a Volunteer</div>
                <iframe style="height:250px" width="100%" src="http://helpnepal.geohives.com/volunteer/"></iframe>
                <div id="div_volunteers">Volunteers:</div>
                <div id="div_bad_volunteers">Volunteers without location:</div>
            </div>
            <div id="map-canvas"></div>
        </div>
    </body>

</html>
